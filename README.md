# 飞鱼USB开关说明

## 简介

随着各种各样的USB供电设备的出现，生活中经常会出现一种场景，那就是操作繁琐，每次都要插拔电源等等！
经常看到那种测电压电流功率的功率计，所以我就想着搞一个可以远程控制的USB开关。

我个人也有很多使用上的痛点：
1. 床头的一个小夜灯离我很远，每次关灯都要我把夜灯给拔掉，
2. 还有一个蓝牙音箱需要充电，但是我经常插着充电就忘记拔掉了，所以就想着搞一个定时的开关，解放双手
3. 还有一个抽水的电池坏了，必须插着线才能用，所以需要单独控制

所以才下定决定做一个这个USB开关，这个设备的功能也比较简单，算不上什么高级的东西，但是我也是没有看到有比较好用的开源作品，所以就自己做一个，做的不好让大家见笑。

## 功能

1. 电源开和关
   > 这个就是设备的核心功能，也是比较简单的功能，就是控制USB开关的电源开和关，实现用电器的电源通断
2. 电压电流功率信息查询
   > 能够在手机页面上查看实时的电压，电流，功率等信息，方便了解设备的工作状态
3. 接入点灯实现远程控制和小爱语音控制
   > 搞这个很大一部分原因就是想远程控制，接入小爱语音，实现语音控制和点灯的app控制。
4. 支持定时开关等操作
   > 定时开关支持两种方式: 
   1. 几点中开启几点钟关闭(每天都会执行)
   2. 倒计时关闭或者开启(即如果是开启状态则倒计时结束则关闭，反之则倒计时结束则开启)
5. 按键功能设置
    > 可以设置单击或者双击按键执行具体的操作逻辑

## 演示视频
待上传

## 原理图

板子使用立创EDA画的，所以需要知道原理图和PCB的小伙伴可以点击以下链接跳转到立创开源地址哦

## 代码烧录

> 熟悉arduino的小伙伴就不需要看这里的说明，如果是对arduino代码编译这些还不太熟悉的小伙伴则可以往下看，我这里也是从之前其他地方拷贝过来的，描述的不对，还请多百度一下才行。

### 1. 软件和驱动安装
   这里由于我之前在点阵时钟的描述中介绍的比较清晰，所以这里不一一介绍了，请点击链接【 [Arduino软件安装及串口驱动安装说明](https://gitee.com/lengff/esp8266-lattice-clock-open#2--%E5%AE%89%E8%A3%85%E5%AF%B9%E5%BA%94%E7%9A%84%E8%BD%AF%E4%BB%B6) 】跳转到页面进行查看

### 2. 代码编译

#### 1. 安装所需要的依赖库文件
- 由于我也是初学者，很多都是使用别人的库文件，自己并没有去深入原理的去重写代码，所以我们需要安装一些库文件
- 安装步骤如下：
  1. `工具 --> 管理库 --> 搜索我们需要安装的库 --> 点击安装即可`
- 需要安装的库文件如下：
    1. `Blinker.h` 点灯科技提供的驱动库
    2. `OneButton` 按键控制的库
    3. `ArduinoJson` JSON内容解析的库
    4. `NTPClient` NTP时间校准的库
    4. `INA226` 功率计算芯片需要用到的库
- 如果有遗漏的库，请看报错提示，按错误提示将其中的库安装一下即可

#### 2. 下载源代码

- `github下载` https://github.com/Lengff/esp8266-lattice-clock-open
- `gitee下载` https://gitee.com/lengff/esp8266-lattice-clock-open

通过上面的地址下载我们的源码，其中代码在目录的`code`目录中，通过`arduino`直接打开`code`目录的文件夹即可。

#### 3. 烧录代码

- 通过`Arduino IDE`打开我们上一步下载好的代码
    1. `文件 --> 打开 --> 选择源码所在文件夹中.ino后缀的文件`
- 选择开发板
    1. `工具 --> 开发板 --> ESP8266 --> NodeMcu 1.0`
- 选择端口
    1. `工具 --> 端口 --> 选择我们串口设备对应的端口`
- 写入程序
    1. `项目 --> 上传 或 点左侧的 → 箭头 （波特率选115200，会快一些）`

## 使用说明

### 1. 设备配网

当你代码烧录完成以后需要做的第一件事情就是设备配网，为了提升配网的体验，目前使用的是`WiFi`网页配网。简单来说就是`ESP8266`设备会提供一个热点，手机连接该热点以后会自动弹出网页进行配网操作。

操作方法如下：

1. 时钟上电，然后会自己产生一个`FY-USB-SWITCH`热点
2. 用手机连接上述热点，然后就会自动弹出配网页面
3. 如果没有弹出来的话，那就自己到手机浏览器输入：`192.168.4.1`一样也会有配网页面
4. 按照页面提示即可完成配网

### 2. 打开设备操作页面



### 3. 点灯功能配置

### 4. 小爱语音配置
